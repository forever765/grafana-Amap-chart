{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","data","panel","map","infoWindow","cluster","markers","mapInitFlag","find","amap_id","Date","getTime","html","pluginInfo","trafficLayer","menu","scale","toolBar","$","getScript","AmapKey","timeer","window","setInterval","console","log","AMap","clearInterval","initMap","events","on","render","legendType","setTimeout","noDataPoints","setMapStyle","mapStyleTypeOpt","styleType","mapStyleType","height","css","addMapChart","clearMap","dataList","type","rows","parent","next","length","columns","i","row","winData","j","text","addMarker","addCluster","valueClusterer","x","mapLat","y","mapLng","zoom","mapZoom","Map","resizeEnable","center","parseInt","addControl","Scale","visible","ToolBar","TileLayer","Traffic","zIndex","autoRefresh","opacity","setMap","show","ContextMenu","me","mouseTool","MouseTool","contextMenuPositon","content","push","contextMenu","isCustom","join","e","open","lnglat","prototype","zoomMenu","tag","zoomOut","zoomIn","close","distanceMeasureMenu","rule","addMarkerMenu","marker","Marker","position","geocoder","Geocoder","radius","geocoderFunction","lnglats","func","getAddress","status","result","address","regeocode","formattedAddress","alert","JSON","stringify","extData","point","event","addListener","cell","target","getExtData","info","InfoWindow","offset","createInfoWindow","getPosition","closeInfoWindow","count","_renderClusterMarker","context","factor","Math","pow","div","document","createElement","Hue","bgColor","fontColor","borderColor","shadowColor","style","backgroundColor","size","round","width","border","borderRadius","boxShadow","innerHTML","lineHeight","color","fontSize","textAlign","setOffset","Pixel","setContent","MarkerClusterer","gridSize","renderClusterMarker","sts","url","Size","styles","title","className","top","titleD","closeX","src","onclick","appendChild","middle","bottom","margin","sharp","clearInfoWindow","incrementRenderCounter","renderingCompleted","_"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\n\n\n\nexport default function link(scope, elem, attrs, ctrl) {\n    var data, panel,map,infoWindow,cluster, markers=[];\n    panel = ctrl.panel;\n    ctrl.panel.mapInitFlag = false;\n    elem = elem.find('.amap_chart_panel_container');\n\n    var amap_id = \"amap_container_\" + new Date().getTime();\n    elem.html('<div id=\"'+amap_id+'\"></div>');\n\n    var pluginInfo  = \"AMap.Geocoder,AMap.MarkerClusterer\";\n    if(ctrl.panel.trafficLayer){\n        pluginInfo +=\",AMap.MarkerClusterer\";\n    }\n    if(ctrl.panel.menu){\n        pluginInfo +=\",AMap.MouseTool\";\n    }\n    if(ctrl.panel.scale){\n        pluginInfo +=\",AMap.Scale\";\n    }\n    if(ctrl.panel.toolBar){\n        pluginInfo +=\",AMap.OverView,AMap.ToolBar\";\n    }\n\n    $.getScript(\"http://webapi.amap.com/maps?v=1.3&key=\" + ctrl.panel.AmapKey + \"&plugin=\" + pluginInfo ,function() {\n\n\n        ctrl.panel.timeer = window.setInterval(function (){\n            console.log(\"init map\");\n            if( typeof AMap == \"object\"){\n                window.clearInterval(ctrl.panel.timeer);\n                initMap();\n            }\n        },1000);\n    });\n\n    ctrl.events.on('render', function () {\n        render(false);\n        if (panel.legendType === 'Right side') {\n          setTimeout(function () { render(true); }, 50);\n        }\n  });\n\n  function noDataPoints() {\n    var html = '<div class=\"datapoints-warning\"><span class=\"small\">No data points</span></div>';\n    elem.html(html);\n  }\n\n  function setMapStyle() {\n      var mapStyleTypeOpt ={\n          '幻影黑':'dark'   ,\n          '月光银':'light'   ,\n          '远山黛':'whitesmoke',\n          '草色青':'fresh'     ,\n          '雅士灰':'grey'      ,\n          '涂鸦'\t:'graffiti'  ,\n          '马卡龙':'macaron'   ,\n          '靛青蓝':'blue'      ,\n          '极夜蓝':'darkblue'  ,\n          '酱籽'\t:'wine'\n      };\n      var styleType = 'dark';\n      if(panel && panel.mapStyleType && \"\" != panel.mapStyleType) {\n          styleType =mapStyleTypeOpt[panel.mapStyleType];\n      }\n      if(map){\n          map.setMapStyle(\"amap://styles/\" + styleType);\n      }\n\n      var height = ctrl.panel.height;\n      if(!height){\n          height =  ctrl.height;\n      }\n\n      console.log(\"height:\" + height);\n\n      $(\"#\" + amap_id).css({\"width\":\"100%\",\"height\":height});\n\n  }\n\n  function addMapChart() {\n\n      if(!ctrl.panel.mapInitFlag){\n          return;\n      }\n      if(map) {\n          setMapStyle();\n          map.clearMap();\n          markers = [];\n          var dataList = ctrl.data[0];\n          if (dataList && dataList.type == \"table\") {\n              var rows = dataList.rows;\n              $(\"#\" + amap_id).parent().next().html(\"</br>总数据量：<span style=\\\"font-size:11px;color:#F00;\\\">\" + rows.length + \"</span><br>\");\n              var columns = dataList.columns;\n              for (var i = 0; i < rows.length; i++) {\n                  var row = rows[i];\n                  var winData = {};\n                  for (var j = 0; j < row.length; j++) {\n                      winData[columns[j].text] = row[j];\n                  }\n                  addMarker(winData);\n              }\n\n              addCluster(ctrl.panel.valueClusterer);\n          }\n      }\n\n  }\n\n    function initMap() {\n        var x = panel.mapLat ;\n        var y = panel.mapLng ;\n        var zoom = panel.mapZoom;\n        map = new AMap.Map(amap_id, {\n            resizeEnable: true,\n            center: [x, y],\n            zoom: parseInt(zoom)\n        });\n        setMapStyle();\n        if(ctrl.panel.scale) {\n            map.addControl(new AMap.Scale({visible: true}));\n        }\n        if(ctrl.panel.toolBar) {\n            map.addControl(new AMap.ToolBar({visible: true}));\n        }\n\n        if(ctrl.panel.trafficLayer) {\n            //实时路况图层\n            var trafficLayer = new AMap.TileLayer.Traffic({\n                zIndex: 10,\n                autoRefresh: true,\n                opacity: 1\n            });\n            trafficLayer.setMap(map);\n            trafficLayer.show();\n        }\n\n\n        if(ctrl.panel.menu) {\n            //创建右键菜单\n            window.menu = new ContextMenu(map);\n            //自定义菜单类\n            function ContextMenu(map) {\n                var me = this;\n                //地图中添加鼠标工具MouseTool插件\n                this.mouseTool = new AMap.MouseTool(map);\n                this.contextMenuPositon = null;\n                var content = [];\n                content.push(\"<div class='info1 context_menu'>\");\n                content.push(\"  <p onclick='menu.zoomMenu(0)'>缩小</p>\");\n                content.push(\"  <p class='split_line' onclick='menu.zoomMenu(1)'>放大</p>\");\n                content.push(\"  <p class='split_line' onclick='menu.distanceMeasureMenu()'>距离量测</p>\");\n                content.push(\"  <p onclick='menu.addMarkerMenu()'>添加标记</p>\");\n                content.push(\"</div>\");\n                //通过content自定义右键菜单内容\n                this.contextMenu = new AMap.ContextMenu({isCustom: true, content: content.join('')});\n                //地图绑定鼠标右击事件——弹出右键菜单\n                map.on('rightclick', function (e) {\n                    me.contextMenu.open(map, e.lnglat);\n                    me.contextMenuPositon = e.lnglat; //右键菜单位置\n                });\n            }\n            ContextMenu.prototype.zoomMenu = function zoomMenu(tag) {//右键菜单缩放地图\n                if (tag === 0) {\n                    map.zoomOut();\n                }\n                if (tag === 1) {\n                    map.zoomIn();\n                }\n                this.contextMenu.close();\n            };\n            ContextMenu.prototype.distanceMeasureMenu = function () {  //右键菜单距离量测\n                this.mouseTool.rule();\n                this.contextMenu.close();\n            };\n            ContextMenu.prototype.addMarkerMenu = function () {  //右键菜单添加Marker标记\n                this.mouseTool.close();\n                var marker = new AMap.Marker({\n                    map: map,\n                    position: this.contextMenuPositon //基点位置\n                });\n                this.contextMenu.close();\n            };\n        }\n\n        ctrl.panel.mapInitFlag = true;\n\n        var geocoder = new AMap.Geocoder({\n            radius: 2000 //范围，默认：500\n        });\n\n        window.geocoderFunction= function (lnglats,scope,func) {\n            geocoder.getAddress(lnglats, function(status, result) {\n                var address = []\n                if (status === 'complete'&&result.regeocode.formattedAddress) {\n                        if(typeof func == 'function'){\n                            func(scope,result.regeocode.formattedAddress);\n                        }\n                }else{\n                    alert(JSON.stringify(result))\n                }\n            });\n        }\n\n        render(true);\n    }\n\n\n    function addMarker(winData) {\n\n        var marker = new AMap.Marker({\n            extData:winData,\n            //map: map,\n            content:'<div class=\"hold\"><span class=\"s1\"></span><span class=\"s2\"></span><span class=\"s3\"></span><span class=\"s4\"><img src=\"http://dev.qingxiangchuxing.com/images/admin/img/car_icon.png\" /></span></div>',\n            position: [winData.point[0], winData.point[1]]\n        });\n        //鼠标点击marker弹出自定义的信息窗体\n        AMap.event.addListener(marker, 'mouseover', function (e) {\n            // 初始化一个信息窗口对象\n            var cell = e.target.getExtData();\n            var info = \"\";\n            for(var i in cell){\n                if(i == \"point\"){\n                    info += i + \":<span onclick='geocoderFunction([\" + cell[i]+\"],$(this),function(_this,a){$(_this).html(a);});' style=\\\"font-size:11px;color:#F00;\\\">\" + cell[i] + \"</span><br>\";\n                }else {\n                    info += i + \":<span style=\\\"font-size:11px;color:#F00;\\\">\" + cell[i] + \"</span><br>\";\n                }\n            }\n            infoWindow = new AMap.InfoWindow({\n                offset:{x:16,y:-54},\n                isCustom: true,  //使用自定义窗体\n                content: createInfoWindow(\"车辆详情\", info)\n            });\n            infoWindow.open(map, marker.getPosition());\n            //$(info).click();\n        });\n\n        AMap.event.addListener(marker,\"mouseout\",function(e){\n            closeInfoWindow();\n        },marker);\n        markers.push(marker);\n    }\n\n    var count = markers.length;\n    var _renderClusterMarker = function (context) {\n        var factor = Math.pow(context.count / count, 1 / 18);\n        var div = document.createElement('div');\n        var Hue = 180 - factor * 180;\n        var bgColor = 'hsla(' + Hue + ',100%,50%,0.7)';\n        var fontColor = 'hsla(' + Hue + ',100%,20%,1)';\n        var borderColor = 'hsla(' + Hue + ',100%,40%,1)';\n        var shadowColor = 'hsla(' + Hue + ',100%,50%,1)';\n        div.style.backgroundColor = bgColor;\n        var size = Math.round(30 + Math.pow(context.count / count, 1 / 5) * 20);\n        div.style.width = div.style.height = size + 'px';\n        div.style.border = 'solid 1px ' + borderColor;\n        div.style.borderRadius = size / 2 + 'px';\n        div.style.boxShadow = '0 0 1px ' + shadowColor;\n        div.innerHTML = context.count;\n        div.style.lineHeight = size + 'px';\n        div.style.color = fontColor;\n        div.style.fontSize = '14px';\n        div.style.textAlign = 'center';\n        context.marker.setOffset(new AMap.Pixel(-size / 2, -size / 2));\n        context.marker.setContent(div)\n    };\n\n    function addCluster(tag) {\n        if (cluster) {\n            cluster.setMap(null);\n        }\n        if (tag == 'typical') {//完全自定义\n            cluster = new AMap.MarkerClusterer(map, markers, {\n                gridSize: 80,\n                renderClusterMarker: _renderClusterMarker\n            });\n        } else if (tag == 'normal') {//自定义图标\n            var sts = [{\n                url: \"https://a.amap.com/jsapi_demos/static/images/blue.png\",\n                size: new AMap.Size(32, 32),\n                offset: new AMap.Pixel(-16, -16)\n            }, {\n                url: \"https://a.amap.com/jsapi_demos/static/images/green.png\",\n                size: new AMap.Size(32, 32),\n                offset: new AMap.Pixel(-16, -16)\n            }, {\n                url: \"https://a.amap.com/jsapi_demos/static/images/orange.png\",\n                size: new AMap.Size(36, 36),\n                offset: new AMap.Pixel(-18, -18)\n            }, {\n                url: \"https://a.amap.com/jsapi_demos/static/images/red.png\",\n                size: new AMap.Size(48, 48),\n                offset: new AMap.Pixel(-24, -24)\n            }, {\n                url: \"https://a.amap.com/jsapi_demos/static/images/darkRed.png\",\n                size: new AMap.Size(48, 48),\n                offset: new AMap.Pixel(-24, -24)\n            }];\n            cluster = new AMap.MarkerClusterer(map, markers, {\n                styles: sts,\n                gridSize: 80\n            });\n        } else {//默认样式\n            cluster = new AMap.MarkerClusterer(map, markers, {gridSize: 80});\n        }\n    }\n\n    function createInfoWindow(title, content) {\n        var info = document.createElement(\"div\");\n        info.className = \"custom-info input-card content-window-card\";\n\n        //可以通过下面的方式修改自定义窗体的宽高\n        //info.style.width = \"400px\";\n        // 定义顶部标题\n        var top = document.createElement(\"div\");\n        var titleD = document.createElement(\"div\");\n        var closeX = document.createElement(\"img\");\n        top.className = \"info-top\";\n        titleD.innerHTML = title;\n        closeX.src = \"https://webapi.amap.com/images/close2.gif\";\n        closeX.onclick = closeInfoWindow;\n\n        top.appendChild(titleD);\n        top.appendChild(closeX);\n        info.appendChild(top);\n\n        // 定义中部内容\n        var middle = document.createElement(\"div\");\n        middle.className = \"info-middle\";\n        middle.style.backgroundColor = 'white';\n        middle.innerHTML = content;\n        info.appendChild(middle);\n\n        // 定义底部内容\n        var bottom = document.createElement(\"div\");\n        bottom.className = \"info-bottom\";\n        bottom.style.position = 'relative';\n        bottom.style.top = '0px';\n        bottom.style.margin = '0 auto';\n        var sharp = document.createElement(\"img\");\n        sharp.src = \"https://webapi.amap.com/images/sharp.png\";\n        bottom.appendChild(sharp);\n        info.appendChild(bottom);\n        return info;\n    }\n\n    //关闭信息窗体\n    function closeInfoWindow() {\n        map.clearInfoWindow();\n    }\n\n\n  function render(incrementRenderCounter) {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n    console.log(panel);\n    if (0 == ctrl.data.length) {\n        noDataPoints();\n        //addMapChart();\n    } else {\n        addMapChart();\n    }\n\n    if (incrementRenderCounter) {\n      ctrl.renderingCompleted();\n    }\n  }\n}\n\n"]}